{"version":3,"file":"builder.js","names":["xml","require","utils","types","hyperlinks","Picture","_addSheetPr","promiseObj","Promise","resolve","reject","o","ws","opts","pageSetup","fitToHeight","fitToWidth","outline","summaryBelow","summaryRight","autoFilter","ref","ele","att","outlineEle","up","_addDimension","firstCell","lastCell","getExcelAlpha","lastUsedCol","lastUsedRow","_addSheetViews","sheetView","sv","showGridLines","workbookViewId","rightToLeft","zoomScale","zoomScaleNormal","zoomScalePageLayoutView","modifiedPaneParams","Object","keys","pane","forEach","k","push","length","pEle","xSplit","ySplit","topLeftCell","activePane","state","_addSheetFormatPr","sheetFormat","baseColWidth","defaultColWidth","defaultRowHeight","thickBottom","boolToInt","thickTop","_addCols","columnCount","colsEle","colId","cols","col","colEle","min","max","width","style","hidden","customWidth","outlineLevel","collapsed","_addSheetData","rows","processRows","theseRows","r","thisRow","cellRefs","sort","sortCellRefs","rEle","disableRowSpansOptimization","spans","s","customFormat","ht","customHeight","thickBot","i","cells","addToXMLele","processNextRows","splice","_addSheetProtection","sheetProtection","includeSheetProtection","sheet","objects","scenarios","getHashOfPassword","_addAutoFilter","startRow","filterRow","startCol","endCol","endRow","firstEmptyRow","undefined","curRow","firstColumn","lastColumn","startCell","endCell","wb","definedNameCollection","addDefinedName","localSheetId","name","refFormula","_addMergeCells","mergedCells","Array","cr","_addConditionalFormatting","cfRulesCollection","_addHyperlinks","hyperlinkCollection","_addDataValidations","dataValidationCollection","_addPrintOptions","addPrintOptions","printOptions","poEle","centerHorizontal","centerVertical","printHeadings","printGridLines","_addPageMargins","margins","left","right","top","bottom","header","footer","_addLegacyDrawing","rId","relationships","indexOf","_addPageSetup","addPageSetup","psEle","paperSize","paperHeight","paperWidth","scale","firstPageNumber","pageOrder","orientation","usePrinterDefaults","blackAndWhite","draft","cellComments","useFirstPageNumber","errors","horizontalDpi","verticalDpi","copies","_addPageBreaks","rowBreaks","pageBreaks","row","rbEle","pos","bEle","colBreaks","column","cbEle","_addHeaderFooter","addHeaderFooter","headerFooter","hfEle","alignWithMargins","differentFirst","differentOddEven","scaleWithDoc","oddHeader","text","oddFooter","evenHeader","evenFooter","firstHeader","firstFooter","_addDrawing","drawingCollection","isEmpty","dId","sheetXML","xmlProlog","xmlString","wsXML","begin","chunk","then","end","e","Error","stack","relsXML","sheetRelRequired","relXML","create","Hyperlink","location","sheetId","doc","commentsXML","commentsXml","author","commentList","comments","uuid","comment","commentsVmlXML","vmlXml","sl","st","position","marginLeft","marginTop","height","zIndex","visibility","fillColor","shape","tb","cd","module","exports"],"sources":["../../../source/lib/worksheet/builder.js"],"sourcesContent":["const xml = require('xmlbuilder');\nconst utils = require('../utils.js');\nconst types = require('../types/index.js');\nconst hyperlinks = require('./classes/hyperlink');\nconst Picture = require('../drawing/picture.js');\n\nlet _addSheetPr = (promiseObj) => {\n    // §18.3.1.82 sheetPr (Sheet Properties)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts;\n\n        // Check if any option that would require the sheetPr element to be added exists\n        if (\n            o.pageSetup.fitToHeight !== null ||\n            o.pageSetup.fitToWidth !== null ||\n            o.outline.summaryBelow !== null ||\n            o.outline.summaryRight !== null ||\n            o.autoFilter.ref !== null\n        ) {\n            let ele = promiseObj.xml.ele('sheetPr');\n\n            if (o.autoFilter.ref) {\n                ele.att('enableFormatConditionsCalculation', 1);\n                ele.att('filterMode', 1);\n            }\n\n            if (o.outline.summaryBelow !== null || o.outline.summaryRight !== null) {\n                let outlineEle = ele.ele('outlinePr');\n                outlineEle.att('applyStyles', 1);\n                outlineEle.att('summaryBelow',  o.outline.summaryBelow === true ? 1 : 0);\n                outlineEle.att('summaryRight',  o.outline.summaryRight === true ? 1 : 0);\n                outlineEle.up();\n            }\n\n            // §18.3.1.65 pageSetUpPr (Page Setup Properties)\n            if (o.pageSetup.fitToHeight !== null || o.pageSetup.fitToWidth !== null) {\n                ele.ele('pageSetUpPr').att('fitToPage', 1).up();\n            }\n            ele.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addDimension = (promiseObj) => {\n    // §18.3.1.35 dimension (Worksheet Dimensions)\n    return new Promise((resolve, reject) => {\n        let firstCell = 'A1';\n        let lastCell = `${utils.getExcelAlpha(promiseObj.ws.lastUsedCol)}${promiseObj.ws.lastUsedRow}`;\n        let ele = promiseObj.xml.ele('dimension');\n        ele.att('ref', `${firstCell}:${lastCell}`);\n        ele.up();\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetViews = (promiseObj) => {\n    // §18.3.1.88 sheetViews (Sheet Views)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetView;\n        let ele = promiseObj.xml.ele('sheetViews');\n        let sv = ele.ele('sheetView')\n        .att('showGridLines', o.showGridLines)\n        .att('workbookViewId', o.workbookViewId)\n        .att('rightToLeft', o.rightToLeft)\n        .att('zoomScale', o.zoomScale)\n        .att('zoomScaleNormal', o.zoomScaleNormal)\n        .att('zoomScalePageLayoutView', o.zoomScalePageLayoutView);\n\n        let modifiedPaneParams = [];\n        Object.keys(o.pane).forEach((k) => {\n            if (o.pane[k] !== null) {\n                modifiedPaneParams.push(k);\n            }\n        });\n        if (modifiedPaneParams.length > 0) {\n            let pEle = sv.ele('pane');\n            o.pane.xSplit !== null ? pEle.att('xSplit', o.pane.xSplit) : null;\n            o.pane.ySplit !== null ? pEle.att('ySplit', o.pane.ySplit) : null;\n            o.pane.topLeftCell !== null ? pEle.att('topLeftCell', o.pane.topLeftCell) : null;\n            o.pane.activePane !== null ? pEle.att('activePane', o.pane.activePane) : null;\n            o.pane.state !== null ? pEle.att('state', o.pane.state) : null;\n            pEle.up();\n        }\n        sv.up();\n        ele.up();\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetFormatPr = (promiseObj) => {\n    // §18.3.1.81 sheetFormatPr (Sheet Format Properties)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetFormat;\n        let ele = promiseObj.xml.ele('sheetFormatPr');\n\n        o.baseColWidth !== null ? ele.att('baseColWidth', o.baseColWidth) : null;\n        o.defaultColWidth !== null ? ele.att('defaultColWidth', o.defaultColWidth) : null;\n        o.defaultRowHeight !== null ? ele.att('defaultRowHeight', o.defaultRowHeight) : ele.att('defaultRowHeight', 16);\n        o.thickBottom !== null ? ele.att('thickBottom', utils.boolToInt(o.thickBottom)) : null;\n        o.thickTop !== null ? ele.att('thickTop', utils.boolToInt(o.thickTop)) : null;\n\n\n        if (typeof o.defaultRowHeight === 'number') {\n            ele.att('customHeight', '1');\n        }\n        ele.up();\n        resolve(promiseObj);\n    });\n};\n\nlet _addCols = (promiseObj) => {\n    // §18.3.1.17 cols (Column Information)\n    return new Promise((resolve, reject) => {\n\n        if (promiseObj.ws.columnCount > 0) {\n            let colsEle = promiseObj.xml.ele('cols');\n\n            for (let colId in promiseObj.ws.cols) {\n                let col = promiseObj.ws.cols[colId];\n                let colEle = colsEle.ele('col');\n\n                col.min !== null ? colEle.att('min', col.min) : null;\n                col.max !== null ? colEle.att('max', col.max) : null;\n                col.width !== null ? colEle.att('width', col.width) : null;\n                col.style !== null ? colEle.att('style', col.style) : null;\n                col.hidden !== null ? colEle.att('hidden', utils.boolToInt(col.hidden)) : null;\n                col.customWidth !== null ? colEle.att('customWidth', utils.boolToInt(col.customWidth)) : null;\n                col.outlineLevel !== null ? colEle.att('outlineLevel', col.outlineLevel) : null;\n                col.collapsed !== null ? colEle.att('collapsed', utils.boolToInt(col.collapsed)) : null;\n                colEle.up();\n            }\n            colsEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetData = (promiseObj) => {\n    // §18.3.1.80 sheetData (Sheet Data)\n    return new Promise((resolve, reject) => {\n\n        let ele = promiseObj.xml.ele('sheetData');\n        let rows = Object.keys(promiseObj.ws.rows);\n\n        let processRows = (theseRows) => {\n            for (var r = 0; r < theseRows.length; r++) {\n                let thisRow = promiseObj.ws.rows[theseRows[r]];\n                thisRow.cellRefs.sort(utils.sortCellRefs);\n\n                let rEle = ele.ele('row');\n\n                rEle.att('r', thisRow.r);\n                if (promiseObj.ws.opts.disableRowSpansOptimization !== true && thisRow.spans) {\n                    rEle.att('spans', thisRow.spans);\n                }\n                thisRow.s !== null ? rEle.att('s', thisRow.s) : null;\n                thisRow.customFormat !== null ? rEle.att('customFormat', thisRow.customFormat) : null;\n                thisRow.ht !== null ? rEle.att('ht', thisRow.ht) : null;\n                thisRow.hidden !== null ? rEle.att('hidden', thisRow.hidden) : null;\n                thisRow.customHeight === true || typeof promiseObj.ws.opts.sheetFormat.defaultRowHeight === 'number' ? rEle.att('customHeight', 1) : null;\n                thisRow.outlineLevel !== null ? rEle.att('outlineLevel', thisRow.outlineLevel) : null;\n                thisRow.collapsed !== null ? rEle.att('collapsed', thisRow.collapsed) : null;\n                thisRow.thickTop !== null ? rEle.att('thickTop', thisRow.thickTop) : null;\n                thisRow.thickBot !== null ? rEle.att('thickBot', thisRow.thickBot) : null;\n\n                for (var i = 0; i < thisRow.cellRefs.length; i++) {\n                    promiseObj.ws.cells[thisRow.cellRefs[i]].addToXMLele(rEle);\n                }\n\n                rEle.up();\n            }\n\n            processNextRows();\n        };\n\n        let processNextRows = () => {\n            let theseRows = rows.splice(0, 500);\n            if (theseRows.length === 0) {\n                ele.up();\n                return resolve(promiseObj);\n            }\n            processRows(theseRows);\n        };\n\n        processNextRows();\n\n    });\n};\n\nlet _addSheetProtection = (promiseObj) => {\n    // §18.3.1.85 sheetProtection (Sheet Protection Options)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetProtection;\n        let includeSheetProtection = false;\n        Object.keys(o).forEach((k) =>  {\n            if (o[k] !== null) {\n                includeSheetProtection = true;\n            }\n        });\n\n        if (includeSheetProtection) {\n            // Set required fields with defaults if not specified\n            o.sheet = o.sheet !== null ? o.sheet : true;\n            o.objects = o.objects !== null ? o.objects : true;\n            o.scenarios = o.scenarios !== null ? o.scenarios : true;\n\n            let ele = promiseObj.xml.ele('sheetProtection');\n            Object.keys(o).forEach((k) => {\n                if (o[k] !== null) {\n                    if (k === 'password') {\n                        ele.att('password', utils.getHashOfPassword(o[k]));\n                    } else {\n                        ele.att(k, utils.boolToInt(o[k]));\n                    }\n                }\n            });\n            ele.up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addAutoFilter = (promiseObj) => {\n    // §18.3.1.2 autoFilter (AutoFilter Settings)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.autoFilter;\n\n        if (typeof o.startRow === 'number') {\n            let ele = promiseObj.xml.ele('autoFilter');\n            let filterRow = promiseObj.ws.rows[o.startRow];\n\n            o.startCol = typeof o.startCol === 'number' ? o.startCol : null;\n            o.endCol = typeof o.endCol === 'number' ? o.endCol : null;\n\n            if (typeof o.endRow !== 'number') {\n                let firstEmptyRow = undefined;\n                let curRow = o.startRow;\n                while (firstEmptyRow === undefined) {\n                    if (!promiseObj.ws.rows[curRow]) {\n                        firstEmptyRow = curRow;\n                    } else {\n                        curRow++;\n                    }\n                }\n\n                o.endRow = firstEmptyRow - 1;\n            }\n\n            // Columns to sort not manually set. filter all columns in this row containing data.\n            if (typeof o.startCol !== 'number' || typeof o.endCol !== 'number') {\n                o.startCol = filterRow.firstColumn;\n                o.endCol = filterRow.lastColumn;\n            }\n\n            let startCell = utils.getExcelAlpha(o.startCol) + o.startRow;\n            let endCell = utils.getExcelAlpha(o.endCol) + o.endRow;\n\n            ele.att('ref', `${startCell}:${endCell}`);\n            promiseObj.ws.wb.definedNameCollection.addDefinedName({\n                hidden: 1,\n                localSheetId: promiseObj.ws.localSheetId,\n                name: '_xlnm._FilterDatabase',\n                refFormula: '\\'' + promiseObj.ws.name + '\\'!' +\n                    '$' + utils.getExcelAlpha(o.startCol) +\n                    '$' + o.startRow +\n                    ':' +\n                    '$' + utils.getExcelAlpha(o.endCol) +\n                    '$' + o.endRow\n            });\n            ele.up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addMergeCells = (promiseObj) => {\n    // §18.3.1.55 mergeCells (Merge Cells)\n    return new Promise((resolve, reject) => {\n\n        if (promiseObj.ws.mergedCells instanceof Array && promiseObj.ws.mergedCells.length > 0) {\n            let ele = promiseObj.xml.ele('mergeCells').att('count', promiseObj.ws.mergedCells.length);\n            promiseObj.ws.mergedCells.forEach((cr) => {\n                ele.ele('mergeCell').att('ref', cr).up();\n            });\n            ele.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addConditionalFormatting = (promiseObj) => {\n    // §18.3.1.18 conditionalFormatting (Conditional Formatting)\n    return new Promise((resolve, reject) => {\n        promiseObj.ws.cfRulesCollection.addToXMLele(promiseObj.xml);\n        resolve(promiseObj);\n    });\n};\n\nlet _addHyperlinks = (promiseObj) => {\n    // §18.3.1.48 hyperlinks (Hyperlinks)\n    return new Promise((resolve, reject) => {\n        promiseObj.ws.hyperlinkCollection.addToXMLele(promiseObj.xml);\n        resolve(promiseObj);\n    });\n};\n\nlet _addDataValidations = (promiseObj) => {\n    // §18.3.1.33 dataValidations (Data Validations)\n    return new Promise((resolve, reject) => {\n        if (promiseObj.ws.dataValidationCollection.length > 0) {\n            promiseObj.ws.dataValidationCollection.addToXMLele(promiseObj.xml);\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addPrintOptions = (promiseObj) => {\n    // §18.3.1.70 printOptions (Print Options)\n    return new Promise((resolve, reject) => {\n\n        let addPrintOptions = false;\n        let o = promiseObj.ws.opts.printOptions;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addPrintOptions = true;\n            }\n        });\n\n        if (addPrintOptions) {\n            let poEle = promiseObj.xml.ele('printOptions');\n            o.centerHorizontal === true ? poEle.att('horizontalCentered', 1) : null;\n            o.centerVertical === true ? poEle.att('verticalCentered', 1) : null;\n            o.printHeadings === true ? poEle.att('headings', 1) : null;\n            if (o.printGridLines === true) {\n                poEle.att('gridLines', 1);\n                poEle.att('gridLinesSet', 1);\n            }\n            poEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addPageMargins = (promiseObj) => {\n    // §18.3.1.62 pageMargins (Page Margins)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.margins;\n\n        promiseObj.xml.ele('pageMargins')\n        .att('left', o.left)\n        .att('right', o.right)\n        .att('top', o.top)\n        .att('bottom', o.bottom)\n        .att('header', o.header)\n        .att('footer', o.footer)\n        .up();\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addLegacyDrawing = (promiseObj) => {\n    return new Promise((resolve, reject) => {\n\n        const rId = promiseObj.ws.relationships.indexOf('commentsVml') + 1;\n        if(rId === 0) {\n            resolve(promiseObj);\n        } else {\n            promiseObj.xml.ele('legacyDrawing')\n            .att('r:id', 'rId' + rId)\n            .up();\n\n            resolve(promiseObj);\n        }\n    })\n}\n\nlet _addPageSetup = (promiseObj) => {\n    // §18.3.1.63 pageSetup (Page Setup Settings)\n    return new Promise((resolve, reject) => {\n\n        let addPageSetup = false;\n        let o = promiseObj.ws.opts.pageSetup;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addPageSetup = true;\n            }\n        });\n\n        if (addPageSetup === true) {\n            let psEle = promiseObj.xml.ele('pageSetup');\n            o.paperSize !== null ? psEle.att('paperSize', types.paperSize[o.paperSize]) : null;\n            o.paperHeight !== null ? psEle.att('paperHeight', o.paperHeight) : null;\n            o.paperWidth !== null ? psEle.att('paperWidth', o.paperWidth) : null;\n            o.scale !== null ? psEle.att('scale', o.scale) : null;\n            o.firstPageNumber !== null ? psEle.att('firstPageNumber', o.firstPageNumber) : null;\n            o.fitToWidth !== null ? psEle.att('fitToWidth', o.fitToWidth) : null;\n            o.fitToHeight !== null ? psEle.att('fitToHeight', o.fitToHeight) : null;\n            o.pageOrder !== null ? psEle.att('pageOrder', o.pageOrder) : null;\n            o.orientation !== null ? psEle.att('orientation', o.orientation) : null;\n            o.usePrinterDefaults !== null ? psEle.att('usePrinterDefaults', utils.boolToInt(o.usePrinterDefaults)) : null;\n            o.blackAndWhite !== null ? psEle.att('blackAndWhite', utils.boolToInt(o.blackAndWhite)) : null;\n            o.draft !== null ? psEle.att('draft', utils.boolToInt(o.draft)) : null;\n            o.cellComments !== null ? psEle.att('cellComments', o.cellComments) : null;\n            o.useFirstPageNumber !== null ? psEle.att('useFirstPageNumber', utils.boolToInt(o.useFirstPageNumber)) : null;\n            o.errors !== null ? psEle.att('errors', o.errors) : null;\n            o.horizontalDpi !== null ? psEle.att('horizontalDpi', o.horizontalDpi) : null;\n            o.verticalDpi !== null ? psEle.att('verticalDpi', o.verticalDpi) : null;\n            o.copies !== null ? psEle.att('copies', o.copies) : null;\n            psEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addPageBreaks = (promiseObj) => {\n    // colBreaks (§18.3.1.14); rowBreaks (§18.3.1.74)\n    const rowBreaks = promiseObj.ws.pageBreaks.row;\n    if (rowBreaks.length > 0) {\n        const rbEle = promiseObj.xml.ele('rowBreaks');\n        rbEle.att('count', rowBreaks.length);\n        rbEle.att('manualBreakCount', rowBreaks.length);\n        rowBreaks.forEach(pos => {\n            const bEle = rbEle.ele('brk');\n            bEle.att('id', pos);\n            bEle.att('man', 1);\n            bEle.up();\n        });\n        rbEle.up();\n    }\n    const colBreaks = promiseObj.ws.pageBreaks.column;\n    if (colBreaks.length > 0) {\n        const cbEle = promiseObj.xml.ele('colBreaks');\n        cbEle.att('count', colBreaks.length);\n        cbEle.att('manualBreakCount', colBreaks.length);\n        colBreaks.forEach(pos => {\n            const bEle = cbEle.ele('brk');\n            bEle.att('id', pos);\n            bEle.att('man', 1);\n            bEle.up();\n        });\n        cbEle.up();\n    }\n    return promiseObj;\n}\n\nlet _addHeaderFooter = (promiseObj) => {\n    // §18.3.1.46 headerFooter (Header Footer Settings)\n    return new Promise((resolve, reject) => {\n\n        let addHeaderFooter = false;\n        let o = promiseObj.ws.opts.headerFooter;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addHeaderFooter = true;\n            }\n        });\n\n        if (addHeaderFooter === true) {\n            let hfEle = promiseObj.xml.ele('headerFooter');\n\n            o.alignWithMargins !== null ? hfEle.att('alignWithMargins', utils.boolToInt(o.alignWithMargins)) : null;\n            o.differentFirst !== null ? hfEle.att('differentFirst', utils.boolToInt(o.differentFirst)) : null;\n            o.differentOddEven !== null ? hfEle.att('differentOddEven', utils.boolToInt(o.differentOddEven)) : null;\n            o.scaleWithDoc !== null ? hfEle.att('scaleWithDoc', utils.boolToInt(o.scaleWithDoc)) : null;\n\n            o.oddHeader !== null ? hfEle.ele('oddHeader').text(o.oddHeader).up() : null;\n            o.oddFooter !== null ? hfEle.ele('oddFooter').text(o.oddFooter).up() : null;\n            o.evenHeader !== null ? hfEle.ele('evenHeader').text(o.evenHeader).up() : null;\n            o.evenFooter !== null ? hfEle.ele('evenFooter').text(o.evenFooter).up() : null;\n            o.firstHeader !== null ? hfEle.ele('firstHeader').text(o.firstHeader).up() : null;\n            o.firstFooter !== null ? hfEle.ele('firstFooter').text(o.firstFooter).up() : null;\n            hfEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addDrawing = (promiseObj) => {\n    // §18.3.1.36 drawing (Drawing)\n    return new Promise((resolve, reject) => {\n        if (!promiseObj.ws.drawingCollection.isEmpty) {\n            let dId = promiseObj.ws.relationships.indexOf('drawing') + 1;\n            promiseObj.xml.ele('drawing').att('r:id', 'rId' + dId).up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet sheetXML = (ws) => {\n    return new Promise((resolve, reject) => {\n\n        let xmlProlog = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>';\n        let xmlString = '';\n        let wsXML = xml.begin({\n          'allowSurrogateChars': true,\n        }, (chunk) => {\n            xmlString += chunk;\n        })\n\n        .ele('worksheet')\n        .att('mc:Ignorable', 'x14ac')\n        .att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main')\n        .att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006')\n        .att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships')\n        .att('xmlns:x14ac', 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');\n\n        // Excel complains if specific elements on not in the correct order in the XML doc as defined in §M.2.2\n        let promiseObj = { xml: wsXML, ws: ws };\n\n        _addSheetPr(promiseObj)\n        .then(_addDimension)\n        .then(_addSheetViews)\n        .then(_addSheetFormatPr)\n        .then(_addCols)\n        .then(_addSheetData)\n        .then(_addSheetProtection)\n        .then(_addAutoFilter)\n        .then(_addMergeCells)\n        .then(_addConditionalFormatting)\n        .then(_addDataValidations)\n        .then(_addHyperlinks)\n        .then(_addPrintOptions)\n        .then(_addPageMargins)\n        .then(_addLegacyDrawing)\n        .then(_addPageSetup)\n        .then(_addPageBreaks)\n        .then(_addHeaderFooter)\n        .then(_addDrawing)\n        .then((promiseObj) => {\n            return new Promise((resolve, reject) => {\n                wsXML.end();\n                resolve(xmlString);\n            });\n        })\n        .then((xml) => {\n            resolve(xml);\n        })\n        .catch((e) => {\n            throw new Error(e.stack);\n        });\n    });\n};\n\nlet relsXML = (ws) => {\n    return new Promise((resolve, reject) => {\n        let sheetRelRequired = false;\n        if (ws.relationships.length > 0) {\n            sheetRelRequired = true;\n        }\n\n        if (sheetRelRequired === false) {\n            resolve();\n        }\n\n        let relXML = xml.create(\n            'Relationships',\n            {\n                'version': '1.0',\n                'encoding': 'UTF-8',\n                'standalone': true,\n                'allowSurrogateChars': true\n            }\n        );\n        relXML.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n        ws.relationships.forEach((r, i) => {\n            let rId = 'rId' + (i + 1);\n            if (r instanceof hyperlinks.Hyperlink) {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', r.location)\n                .att('TargetMode', 'External')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink');\n            } else if (r === 'drawing') {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', '../drawings/drawing' + ws.sheetId + '.xml')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing');\n            } else if (r === 'comments') {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', '../comments' + ws.sheetId + '.xml')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments');\n            } else if (r === 'commentsVml') {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', '../drawings/commentsVml' + ws.sheetId + '.vml')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing');\n            }\n        });\n        let xmlString = relXML.doc().end();\n        resolve(xmlString);\n    });\n};\n\nlet commentsXML = (ws) => {\n    return new Promise((resolve, reject) => {\n        const commentsXml = xml.create(\n            'comments',\n            {\n                'version': '1.0',\n                'encoding': 'UTF-8',\n                'standalone': true,\n                'allowSurrogateChars': true\n            }\n        );\n        commentsXml.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');\n\n        commentsXml.ele('authors').ele('author').text(ws.wb.author);\n\n        const commentList = commentsXml.ele('commentList');\n        Object.keys(ws.comments).forEach(ref => {\n            commentList\n                .ele('comment')\n                .att('ref', ref)\n                .att('authorId', '0')\n                .att('guid', ws.comments[ref].uuid)\n                .ele('text')\n                .ele('t')\n                .text(ws.comments[ref].comment);\n        });\n        let xmlString = commentsXml.doc().end();\n        resolve(xmlString);\n    });\n}\n\nlet commentsVmlXML = (ws) => {\n    return new Promise((resolve, reject) => {\n        // do not add XML prolog to document\n        const vmlXml = xml.begin().ele('xml');\n        vmlXml.att('xmlns:v', 'urn:schemas-microsoft-com:vml')\n        vmlXml.att('xmlns:o', 'urn:schemas-microsoft-com:office:office');\n        vmlXml.att('xmlns:x', 'urn:schemas-microsoft-com:office:excel');\n\n        const sl = vmlXml.ele('o:shapelayout').att('v:ext', 'edit');\n        sl.ele('o:idmap').att('v:ext', 'edit').att('data', ws.sheetId);\n\n        const st = vmlXml.ele('v:shapetype')\n            .att('id', '_x0000_t202')\n            .att('coordsize', '21600,21600')\n            .att('o:spt', '202')\n            .att('path', 'm,l,21600r21600,l21600,xe');\n        st.ele('v:stroke').att('joinstyle', 'miter');\n        st.ele('v:path').att('gradientshapeok', 't').att('o:connecttype', 'rect');\n\n        Object.keys(ws.comments).forEach((ref) => {\n            const {row, col, position, marginLeft, marginTop, width, height, zIndex, visibility, fillColor} = ws.comments[ref];\n            const shape = vmlXml.ele('v:shape');\n            shape.att('id', `_${ws.sheetId}_${row}_${col}`);\n            shape.att('type', \"#_x0000_t202\");\n            shape.att('style', `position:${position};margin-left:${marginLeft};margin-top:${marginTop};width:${width};height:${height};z-index:${zIndex};visibility:${visibility}`);\n            shape.att('fillcolor', fillColor);\n            shape.att('o:insetmode', 'auto');\n\n            shape.ele('v:path').att('o:connecttype', 'none');\n\n            const tb = shape.ele('v:textbox').att('style', 'mso-direction-alt:auto');\n            tb.ele('div').att('style', 'text-align:left');\n\n            const cd = shape.ele('x:ClientData').att('ObjectType', 'Note');\n            cd.ele('x:MoveWithCells');\n            cd.ele('x:SizeWithCells');\n            cd.ele('x:AutoFill').text('False');\n            cd.ele('x:Row').text(row - 1);\n            cd.ele('x:Column').text(col - 1);\n        });\n\n\n        let xmlString = vmlXml.doc().end();\n        resolve(xmlString);\n    });\n}\n\nmodule.exports = { sheetXML, relsXML, commentsXML, commentsVmlXML };\n"],"mappings":"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"}