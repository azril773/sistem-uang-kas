{"version":3,"file":"builder.js","names":["xmlbuilder","require","JSZip","fs","CTColor","utils","addRootContentTypesXML","promiseObj","Promise","resolve","reject","xml","create","att","contentTypesAdded","extensionsAdded","wb","sheets","forEach","s","i","drawingCollection","length","drawings","d","indexOf","extension","typeRef","contentType","ele","push","Object","keys","comments","sheetId","xmlString","doc","end","xmlOutVars","xlsx","file","addRootRelsXML","folder","addWorkbookXML","booksViewEle","workbookViewEle","opts","workbookView","viewOpts","activeTab","undefined","firstVisibleTab","sheet","hidden","autoFilterDateGrouping","boolToInt","firstSheet","minimized","showHorizontalScroll","showSheetTabs","showVerticalScroll","tabRatio","visibility","windowWidth","windowHeight","xWindow","yWindow","showComments","sheetsEle","name","printArea","startCellRef","getExcelAlpha","startCol","startRow","endCellRef","endCol","endRow","definedNameCollection","addDefinedName","localSheetId","refFormula","isEmpty","addToXMLele","addWorkbookRelsXML","addCorePropertiesXML","text","author","dtStr","Date","toISOString","addWorksheetsXML","curSheet","processNextSheet","thisSheet","generateXML","then","generateRelsXML","generateCommentsXML","generateCommentsVmlXML","e","logger","error","stack","addSharedStringsXML","sharedStrings","txt","Array","thisSI","theseRuns","currProps","curRun","props","k","value","run","thisRun","thisRunProps","bold","italics","strike","outline","shadow","condense","extend","color","thisColor","size","underline","vertAlign","addStylesXML","styleData","numFmts","nfXML","nf","fontXML","fonts","f","fillXML","fills","fXML","borderXML","borders","b","cellStyleXfsXML","cellXfsXML","styles","addXFtoXMLele","cellStylesXML","dxfCollection","addDrawingsXML","mediaCollection","ws","drawingRelXML","drawingsXML","kind","target","id","image","imagePath","readFileSync","rId","type","drawingsXMLStr","drawingRelXMLStr","writeToBuffer","addWorksheet","jszip","generateAsync","buf","workbookXML","result","files","_data","module","exports"],"sources":["../../../source/lib/workbook/builder.js"],"sourcesContent":["const xmlbuilder = require('xmlbuilder');\nconst JSZip = require('jszip');\nconst fs = require('fs');\nconst CTColor = require('../style/classes/ctColor.js');\nconst utils = require('../utils');\n\nlet addRootContentTypesXML = (promiseObj) => {\n  // Required as stated in §12.2\n  return new Promise((resolve, reject) => {\n    let xml = xmlbuilder.create(\n        'Types', {\n          'version': '1.0',\n          'encoding': 'UTF-8',\n          'standalone': true,\n          'allowSurrogateChars': true\n        }\n      )\n      .att('xmlns', 'http://schemas.openxmlformats.org/package/2006/content-types');\n\n    let contentTypesAdded = [];\n    let extensionsAdded = [];\n    promiseObj.wb.sheets.forEach((s, i) => {\n      if (s.drawingCollection.length > 0) {\n        s.drawingCollection.drawings.forEach((d) => {\n          if (extensionsAdded.indexOf(d.extension) < 0) {\n            let typeRef = d.contentType + '.' + d.extension;\n            if (contentTypesAdded.indexOf(typeRef) < 0) {\n              xml.ele('Default').att('ContentType', d.contentType).att('Extension', d.extension);\n              contentTypesAdded.push(typeRef);\n            }\n            extensionsAdded.push(d.extension);\n          }\n        });\n      }\n      if (Object.keys(s.comments).length > 0) {\n        if (extensionsAdded.indexOf('vml') < 0) {\n          xml.ele('Default').att('Extension', 'vml').att('ContentType', 'application/vnd.openxmlformats-officedocument.vmlDrawing');\n          extensionsAdded.push('vml');\n        }\n      }\n    });\n    xml.ele('Default').att('ContentType', 'application/xml').att('Extension', 'xml');\n    xml.ele('Default').att('ContentType', 'application/vnd.openxmlformats-package.relationships+xml').att('Extension', 'rels');\n    xml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml').att('PartName', '/xl/workbook.xml');\n    promiseObj.wb.sheets.forEach((s, i) => {\n      xml.ele('Override')\n        .att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml')\n        .att('PartName', `/xl/worksheets/sheet${i + 1}.xml`);\n\n      if (s.drawingCollection.length > 0) {\n        xml.ele('Override')\n          .att('ContentType', 'application/vnd.openxmlformats-officedocument.drawing+xml')\n          .att('PartName', '/xl/drawings/drawing' + s.sheetId + '.xml');\n      }\n      if (Object.keys(s.comments).length > 0) {\n        xml.ele('Override')\n          .att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml')\n          .att('PartName', '/xl/comments' + s.sheetId + '.xml');\n      }\n    });\n    xml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml').att('PartName', '/xl/styles.xml');\n    xml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml').att('PartName', '/xl/sharedStrings.xml');\n    xml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-package.core-properties+xml').att('PartName', '/docProps/core.xml');\n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.file('[Content_Types].xml', xmlString);\n    resolve(promiseObj);\n  });\n};\n\nlet addRootRelsXML = (promiseObj) => {\n  // Required as stated in §12.2\n  return new Promise((resolve, reject) => {\n    let xml = xmlbuilder.create(\n        'Relationships', {\n          'version': '1.0',\n          'encoding': 'UTF-8',\n          'standalone': true,\n          'allowSurrogateChars': true\n        }\n      )\n      .att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n    xml\n      .ele('Relationship')\n      .att('Id', 'rId1')\n      .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument')\n      .att('Target', 'xl/workbook.xml');\n\n    xml\n      .ele('Relationship')\n      .att('Id', 'rId2')\n      .att('Type', 'http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties')\n      .att('Target', 'docProps/core.xml');\n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.folder('_rels').file('.rels', xmlString);\n    resolve(promiseObj);\n\n  });\n};\n\nlet addWorkbookXML = (promiseObj) => {\n  // Required as stated in §12.2\n  return new Promise((resolve, reject) => {\n\n    let xml = xmlbuilder.create(\n      'workbook', {\n        'version': '1.0',\n        'encoding': 'UTF-8',\n        'standalone': true,\n        'allowSurrogateChars': true\n      }\n    );\n    xml.att('mc:Ignorable', 'x15');\n    xml.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');\n    xml.att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006');\n    xml.att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships');\n    xml.att('xmlns:x15', 'http://schemas.microsoft.com/office/spreadsheetml/2010/11/main');\n\n    let booksViewEle = xml.ele('bookViews');\n    let workbookViewEle = booksViewEle.ele('workbookView');\n    // bookViews (§18.2.1)\n    if (promiseObj.wb.opts.workbookView) {\n      const viewOpts = promiseObj.wb.opts.workbookView;\n      if (viewOpts.activeTab !== null && viewOpts.activeTab !== undefined) {\n        workbookViewEle.att('activeTab', viewOpts.activeTab);\n      } else {\n        let firstVisibleTab = 0;\n        for (let i = 0; i < promiseObj.wb.sheets.length; i++) {\n          const sheet = promiseObj.wb.sheets[i];\n          if (!sheet.opts.hidden) {\n            firstVisibleTab = i;\n            break;\n          }\n        }\n        workbookViewEle.att('activeTab', firstVisibleTab);\n      }\n      if (viewOpts.autoFilterDateGrouping) {\n        workbookViewEle.att('autoFilterDateGrouping', utils.boolToInt(viewOpts.autoFilterDateGrouping));\n      }\n      if (viewOpts.firstSheet) {\n        workbookViewEle.att('firstSheet', viewOpts.firstSheet);\n      }\n      if (viewOpts.minimized) {\n        workbookViewEle.att('minimized', utils.boolToInt(viewOpts.minimized));\n      }\n      if (viewOpts.showHorizontalScroll) {\n        workbookViewEle.att('showHorizontalScroll', utils.boolToInt(viewOpts.showHorizontalScroll));\n      }\n      if (viewOpts.showSheetTabs) {\n        workbookViewEle.att('showSheetTabs', utils.boolToInt(viewOpts.showSheetTabs));\n      }\n      if (viewOpts.showVerticalScroll) {\n        workbookViewEle.att('showVerticalScroll', utils.boolToInt(viewOpts.showVerticalScroll));\n      }\n      if (viewOpts.tabRatio) {\n        workbookViewEle.att('tabRatio', viewOpts.tabRatio);\n      }\n      if (viewOpts.visibility) {\n        workbookViewEle.att('visibility', viewOpts.visibility);\n      }\n      if (viewOpts.windowWidth) {\n        workbookViewEle.att('windowWidth', viewOpts.windowWidth);\n      }\n      if (viewOpts.windowHeight) {\n        workbookViewEle.att('windowHeight', viewOpts.windowHeight);\n      }\n      if (viewOpts.xWindow) {\n        workbookViewEle.att('xWindow', viewOpts.xWindow);\n      }\n      if (viewOpts.yWindow) {\n        workbookViewEle.att('yWindow', viewOpts.yWindow);\n      }\n      if (viewOpts.showComments) {\n        workbookViewEle.att('showComments', viewOpts.showComments);\n      }\n    }\n\n    let sheetsEle = xml.ele('sheets');\n    promiseObj.wb.sheets.forEach((s, i) => {\n      const sheet = sheetsEle.ele('sheet')\n        .att('name', s.name)\n        .att('sheetId', i + 1)\n        .att('r:id', `rId${i + 1}`);\n\n      if (s.opts.hidden) {\n        sheet.att('state', 'hidden');\n      }\n\n      if (s.printArea) {\n        const name = s.name;\n        const startCellRef = `$${utils.getExcelAlpha(s.printArea.startCol)}$${s.printArea.startRow}`;\n        const endCellRef = `$${utils.getExcelAlpha(s.printArea.endCol)}$${s.printArea.endRow}`;\n        s.wb.definedNameCollection.addDefinedName({\n          name: '_xlnm.Print_Area',\n          localSheetId: s.localSheetId,\n          refFormula: `'${name}'!${startCellRef}:${endCellRef}`,\n        });\n      }\n    });\n\n    if (!promiseObj.wb.definedNameCollection.isEmpty) {\n      promiseObj.wb.definedNameCollection.addToXMLele(xml);\n    }\n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.folder('xl').file('workbook.xml', xmlString);\n    resolve(promiseObj);\n\n  });\n};\n\nlet addWorkbookRelsXML = (promiseObj) => {\n  // Required as stated in §12.2\n  return new Promise((resolve, reject) => {\n\n    let xml = xmlbuilder.create(\n        'Relationships', {\n          'version': '1.0',\n          'encoding': 'UTF-8',\n          'standalone': true,\n          'allowSurrogateChars': true\n        }\n      )\n      .att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n    xml\n      .ele('Relationship')\n      .att('Id', `rId${promiseObj.wb.sheets.length + 1}`)\n      .att('Target', 'sharedStrings.xml')\n      .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings');\n\n    xml\n      .ele('Relationship')\n      .att('Id', `rId${promiseObj.wb.sheets.length + 2}`)\n      .att('Target', 'styles.xml')\n      .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles');\n\n    promiseObj.wb.sheets.forEach((s, i) => {\n      xml\n        .ele('Relationship')\n        .att('Id', `rId${i + 1}`)\n        .att('Target', `worksheets/sheet${i + 1}.xml`)\n        .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet');\n    });\n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.folder('xl').folder('_rels').file('workbook.xml.rels', xmlString);\n    resolve(promiseObj);\n\n  });\n};\n\nlet addCorePropertiesXML = (promiseObj) => {\n  let xml = xmlbuilder.create(\n    'cp:coreProperties', {\n      'version': '1.0',\n      'encoding': 'UTF-8',\n      'standalone': true\n    }\n  )\n  .att('xmlns:cp', 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties')\n  .att('xmlns:dc', 'http://purl.org/dc/elements/1.1/')\n  .att('xmlns:dcterms', 'http://purl.org/dc/terms/')\n  .att('xmlns:dcmitype', 'http://purl.org/dc/dcmitype/')\n  .att('xmlns:xsi', 'http://www.w3.org/2001/XMLSchema-instance');\n\n  xml.ele('dc:creator').text(promiseObj.wb.author);\n  xml.ele('cp:lastModifiedBy').text(promiseObj.wb.author);\n  let dtStr = new Date().toISOString();\n  xml.ele('dcterms:created').att('xsi:type', 'dcterms:W3CDTF').text(dtStr);\n  xml.ele('dcterms:modified').att('xsi:type', 'dcterms:W3CDTF').text(dtStr);\n  let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n  promiseObj.xlsx.folder('docProps').file('core.xml', xmlString);\n  return promiseObj;\n};\n\nlet addWorksheetsXML = (promiseObj) => {\n  // Required as stated in §12.2\n  return new Promise((resolve, reject) => {\n\n    let curSheet = 0;\n\n    let processNextSheet = () => {\n      let thisSheet = promiseObj.wb.sheets[curSheet];\n      if (thisSheet) {\n        curSheet++;\n        thisSheet.generateXML()\n          .then((xml) => {\n            return new Promise((resolve) => {\n              // Add worksheet to zip\n              promiseObj.xlsx.folder('xl').folder('worksheets').file(`sheet${curSheet}.xml`, xml);\n\n              resolve();\n            });\n          })\n          .then(() => {\n            return thisSheet.generateRelsXML();\n          })\n          .then((xml) => {\n            return new Promise((resolve) => {\n              if (xml) {\n                promiseObj.xlsx.folder('xl').folder('worksheets').folder('_rels').file(`sheet${curSheet}.xml.rels`, xml);\n              }\n              resolve();\n            });\n          })\n          .then(() => {\n            return thisSheet.generateCommentsXML();\n          })\n          .then((xml) => {\n            return new Promise((resolve) => {\n              if (xml) {\n                promiseObj.xlsx.folder('xl').file(`comments${curSheet}.xml`, xml);\n              }\n              resolve();\n            });\n          })\n          .then(() => {\n            return thisSheet.generateCommentsVmlXML();\n          })\n          .then((xml) => {\n            return new Promise((resolve) => {\n              if (xml) {\n                promiseObj.xlsx.folder('xl').folder('drawings').file(`commentsVml${curSheet}.vml`, xml);\n              }\n              resolve();\n            });\n          })\n          .then(processNextSheet)\n          .catch((e) => {\n            promiseObj.wb.logger.error(e.stack);\n          });\n      } else {\n        resolve(promiseObj);\n      }\n    };\n    processNextSheet();\n\n  });\n};\n\n/**\n * Generate XML for SharedStrings.xml file and add it to zip file. Called from _writeToBuffer()\n * @private\n * @memberof Workbook\n * @param {Object} promiseObj object containing jszip instance, workbook intance and xmlvars\n * @return {Promise} Resolves with promiseObj\n */\nlet addSharedStringsXML = (promiseObj) => {\n  // §12.3.15 Shared String Table Part\n  return new Promise((resolve, reject) => {\n\n    let xml = xmlbuilder.create(\n        'sst', {\n          'version': '1.0',\n          'encoding': 'UTF-8',\n          'standalone': true,\n          'allowSurrogateChars': true\n        }\n      )\n      .att('count', promiseObj.wb.sharedStrings.length)\n      .att('uniqueCount', promiseObj.wb.sharedStrings.length)\n      .att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');\n\n    promiseObj.wb.sharedStrings.forEach((s) => {\n      if (typeof s === 'string') {\n        xml.ele('si').ele('t').txt(s);\n      } else if (s instanceof Array) {\n\n        let thisSI = xml.ele('si');\n        let theseRuns = []; // §18.4.4 r (Rich Text Run)\n        let currProps = {};\n        let curRun;\n        let i = 0;\n        while (i < s.length) {\n          if (typeof s[i] === 'string') {\n            if (curRun === undefined) {\n              theseRuns.push({\n                props: {},\n                text: ''\n              });\n              curRun = theseRuns[theseRuns.length - 1];\n            }\n            curRun.text = curRun.text + s[i];\n          } else if (typeof s[i] === 'object') {\n            theseRuns.push({\n              props: {},\n              text: ''\n            });\n            curRun = theseRuns[theseRuns.length - 1];\n            Object.keys(s[i]).forEach((k) => {\n              currProps[k] = s[i][k];\n            });\n            Object.keys(currProps).forEach((k) => {\n              curRun.props[k] = currProps[k];\n            });\n            if (s[i].value !== undefined) {\n              curRun.text = s[i].value;\n            }\n          }\n          i++;\n        }\n\n        theseRuns.forEach((run) => {\n          if (Object.keys(run).length < 1) {\n            thisSI.ele('t', run.text).att('xml:space', 'preserve');\n          } else {\n            let thisRun = thisSI.ele('r');\n            let thisRunProps = thisRun.ele('rPr');\n            typeof run.props.name === 'string' ? thisRunProps.ele('rFont').att('val', run.props.name) : null;\n            run.props.bold === true ? thisRunProps.ele('b') : null;\n            run.props.italics === true ? thisRunProps.ele('i') : null;\n            run.props.strike === true ? thisRunProps.ele('strike') : null;\n            run.props.outline === true ? thisRunProps.ele('outline') : null;\n            run.props.shadow === true ? thisRunProps.ele('shadow') : null;\n            run.props.condense === true ? thisRunProps.ele('condense') : null;\n            run.props.extend === true ? thisRunProps.ele('extend') : null;\n            if (typeof run.props.color === 'string') {\n              let thisColor = new CTColor(run.props.color);\n              thisColor.addToXMLele(thisRunProps);\n            }\n            typeof run.props.size === 'number' ? thisRunProps.ele('sz').att('val', run.props.size) : null;\n            run.props.underline === true ? thisRunProps.ele('u') : null;\n            typeof run.props.vertAlign === 'string' ? thisRunProps.ele('vertAlign').att('val', run.props.vertAlign) : null;\n            thisRun.ele('t', run.text).att('xml:space', 'preserve');\n          }\n        });\n\n      }\n    });\n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.folder('xl').file('sharedStrings.xml', xmlString);\n\n    resolve(promiseObj);\n\n  });\n};\n\nlet addStylesXML = (promiseObj) => {\n  // §12.3.20 Styles Part\n  return new Promise((resolve, reject) => {\n\n    let xml = xmlbuilder.create(\n        'styleSheet', {\n          'version': '1.0',\n          'encoding': 'UTF-8',\n          'standalone': true,\n          'allowSurrogateChars': true\n        }\n      )\n      .att('mc:Ignorable', 'x14ac')\n      .att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main')\n      .att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006')\n      .att('xmlns:x14ac', 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');\n\n    if (promiseObj.wb.styleData.numFmts.length > 0) {\n      let nfXML = xml\n        .ele('numFmts')\n        .att('count', promiseObj.wb.styleData.numFmts.length);\n      promiseObj.wb.styleData.numFmts.forEach((nf) => {\n        nf.addToXMLele(nfXML);\n      });\n    }\n\n    let fontXML = xml\n      .ele('fonts')\n      .att('count', promiseObj.wb.styleData.fonts.length);\n    promiseObj.wb.styleData.fonts.forEach((f) => {\n      f.addToXMLele(fontXML);\n    });\n\n    let fillXML = xml\n      .ele('fills')\n      .att('count', promiseObj.wb.styleData.fills.length);\n    promiseObj.wb.styleData.fills.forEach((f) => {\n      let fXML = fillXML.ele('fill');\n      f.addToXMLele(fXML);\n    });\n\n    let borderXML = xml\n      .ele('borders')\n      .att('count', promiseObj.wb.styleData.borders.length);\n    promiseObj.wb.styleData.borders.forEach((b) => {\n      b.addToXMLele(borderXML);\n    });\n\n    let cellStyleXfsXML = xml\n      .ele('cellStyleXfs')\n      .att('count', 1);\n    \n    cellStyleXfsXML.ele('xf')\n      .att('numFmtId', '0')\n      .att('fontId', '0')\n      .att('fillId','0')\n      .att('borderId', '0')\n      .att('applyFont', 'true')\n      .att('applyBorder', 'false')\n      .att('applyAlignment', 'false')\n      .att('applyProtection', 'false');\n\n    let cellXfsXML = xml\n      .ele('cellXfs')\n      .att('count', promiseObj.wb.styles.length);\n    promiseObj.wb.styles.forEach((s) => {\n      s.addXFtoXMLele(cellXfsXML);\n    });\n    \n\n    // insert default cell style\n    let cellStylesXML = xml\n      .ele('cellStyles')\n      .att('count', 1);\n    cellStylesXML.ele('cellStyle')\n      .att('name', 'Normal')\n      .att('xfId', '0')\n      .att('builtinId', '0');\n\n    if (promiseObj.wb.dxfCollection.length > 0) {\n      promiseObj.wb.dxfCollection.addToXMLele(xml);\n    } \n\n    let xmlString = xml.doc().end(promiseObj.xmlOutVars);\n    promiseObj.xlsx.folder('xl').file('styles.xml', xmlString);\n\n    resolve(promiseObj);\n  });\n};\n\nlet addDrawingsXML = (promiseObj) => {\n  return new Promise((resolve) => {\n    if (!promiseObj.wb.mediaCollection.isEmpty) {\n\n      promiseObj.wb.sheets.forEach((ws) => {\n        if (!ws.drawingCollection.isEmpty) {\n\n          let drawingRelXML = xmlbuilder.create('Relationships', {\n              'version': '1.0',\n              'encoding': 'UTF-8',\n              'standalone': true,\n              'allowSurrogateChars': true\n            })\n            .att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n          let drawingsXML = xmlbuilder.create(\n            'xdr:wsDr', {\n              'version': '1.0',\n              'encoding': 'UTF-8',\n              'standalone': true,\n              'allowSurrogateChars': true\n            }\n          );\n          drawingsXML\n            .att('xmlns:a', 'http://schemas.openxmlformats.org/drawingml/2006/main')\n            .att('xmlns:xdr', 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing');\n\n          ws.drawingCollection.drawings.forEach((d) => {\n\n            if (d.kind === 'image') {\n              let target = 'image' + d.id + '.' + d.extension;\n\n              let image = d.imagePath ? fs.readFileSync(d.imagePath) : d.image;\n              promiseObj.xlsx.folder('xl').folder('media').file(target, image);\n\n              drawingRelXML.ele('Relationship')\n                .att('Id', d.rId)\n                .att('Target', '../media/' + target)\n                .att('Type', d.type);\n\n            }\n\n\n\n            d.addToXMLele(drawingsXML);\n\n          });\n\n          let drawingsXMLStr = drawingsXML.doc().end(promiseObj.xmlOutVars);\n          let drawingRelXMLStr = drawingRelXML.doc().end(promiseObj.xmlOutVars);\n          promiseObj.xlsx.folder('xl').folder('drawings').file('drawing' + ws.sheetId + '.xml', drawingsXMLStr);\n          promiseObj.xlsx.folder('xl').folder('drawings').folder('_rels').file('drawing' + ws.sheetId + '.xml.rels', drawingRelXMLStr);\n        }\n      });\n\n    }\n    resolve(promiseObj);\n  });\n};\n\n/**\n * Use JSZip to generate file to a node buffer\n * @private\n * @memberof Workbook\n * @param {Workbook} wb Workbook instance\n * @return {Promise} resolves with Buffer\n */\nlet writeToBuffer = (wb) => {\n  return new Promise((resolve, reject) => {\n    let promiseObj = {\n      wb: wb,\n      xlsx: new JSZip(),\n      xmlOutVars: {}\n    };\n\n    if (promiseObj.wb.sheets.length === 0) {\n      promiseObj.wb.addWorksheet();\n    }\n\n    addRootContentTypesXML(promiseObj)\n      .then(addWorksheetsXML)\n      .then(addRootRelsXML)\n      .then(addWorkbookXML)\n      .then(addWorkbookRelsXML)\n      .then(addCorePropertiesXML)\n      .then(addSharedStringsXML)\n      .then(addStylesXML)\n      .then(addDrawingsXML)\n      .then(() => {\n        wb.opts.jszip.type = 'nodebuffer';\n        promiseObj.xlsx.generateAsync(wb.opts.jszip)\n          .then((buf) => {\n            resolve(buf);\n          })\n          .catch((e) => {\n            reject(e);\n          });\n      })\n      .catch((e) => {\n        reject(e);\n      });\n\n  });\n};\n\n/**\n * @desc Currently only used for testing the XML generated for a Workbook.\n * @param {*} wb Workbook instance\n * @return {Promise} resolves with Workbook XML\n */\nlet workbookXML = (wb) => {\n  let promiseObj = {\n    wb: wb,\n    xlsx: new JSZip(),\n    xmlOutVars: {}\n  };\n\n  return addWorkbookXML(promiseObj).then((result) => {\n    return result.xlsx.files['xl/workbook.xml']._data;\n  });\n}\n\nmodule.exports = {\n  writeToBuffer,\n  workbookXML\n};\n"],"mappings":"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"}